---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import Hero from '../components/Hero.astro';
import WatchLearn from '../components/WatchLearn.astro';
import ResourceCard from '../components/ResourceCard.astro';

const base = import.meta.env.BASE_URL;

// Get all resources sorted by date
const allResources = (await getCollection('resources')).sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

// Featured resource is the most recent
const featuredResource = allResources[0];
// Rest of resources for the grid
const resources = allResources.slice(1);
---

<BaseLayout title="Agentforce Vibes">
  <Hero 
    title="Agentforce Vibes Resources" 
    description="Explore curated resources, watch video tutorials, discover best practices, and access essential tools to supercharge your Salesforce development with Agentforce Vibes."
  />
  
  {featuredResource && (
    <section class="featured-post">
      <div class="container">
        <a href={featuredResource.data.url} target="_blank" rel="noopener noreferrer" class="featured-post__card">
          <div class="featured-post__image">
            <img src={featuredResource.data.image} alt={featuredResource.data.title} />
          </div>
          <div class="featured-post__content">
            <span class="featured-post__badge">
              <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
              </svg>
              Featured
            </span>
            <h2 class="featured-post__title">{featuredResource.data.title}</h2>
            {featuredResource.data.description && <p class="featured-post__excerpt">{featuredResource.data.description}</p>}
            <div class="featured-post__meta">{featuredResource.data.type}</div>
          </div>
        </a>
      </div>
    </section>
  )}
  
  {resources.length > 0 && (
    <section class="posts-section">
      <div class="container">
        <div class="posts-section__header">
          <h2 class="posts-section__title">Latest Resources</h2>
        </div>
        <div class="posts-grid">
          {resources.map((resource) => (
            <ResourceCard 
              title={resource.data.title}
              description={resource.data.description}
              type={resource.data.type}
              url={resource.data.url}
              image={resource.data.image}
            />
          ))}
        </div>
        <div class="section-view-all">
          <a href={base + "/resources"} class="view-all-link">
            View All Resources
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M5 12h14"></path>
              <path d="m12 5 7 7-7 7"></path>
            </svg>
          </a>
        </div>
      </div>
    </section>
  )}
  
  <WatchLearn />
</BaseLayout>
